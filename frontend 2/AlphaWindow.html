<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AlphaWindow — Command Cockpit</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Eczar:wght@400;500;600;700;800&family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
<style>
.dash-layout{
  display:grid;grid-template-columns:248px 1fr;
  flex:1;min-height:calc(100vh - 52px);
}
.sidebar{
  border-right:var(--bdr);background:var(--bg1);
  overflow-y:auto;padding:14px 0;display:flex;flex-direction:column;
}
.sl{font-size:clamp(8px,.58vw,10px);color:var(--txtD);letter-spacing:.15em;text-transform:uppercase;padding:0 14px;margin-bottom:8px}
.stk{
  display:flex;align-items:center;justify-content:space-between;
  padding:8px 10px;border-radius:var(--r1);cursor:pointer;
  border:1px solid transparent;transition:all 140ms ease;margin:0 8px 2px;
  text-decoration:none;color:inherit;
}
.stk:hover{background:var(--goldG);border-color:var(--goldBdr)}
.stk.active{background:var(--goldG);border-color:var(--goldBdr)}
.stk-sym{font-family:var(--fm);font-size:clamp(10px,.8vw,12px);font-weight:600;color:var(--txt)}
.stk.active .stk-sym{color:var(--gold)}
.stk-p{text-align:right}
.stk-val{font-family:var(--fm);font-size:clamp(10px,.8vw,12px);font-weight:600}
.stk-chg{font-family:var(--fm);font-size:clamp(8px,.58vw,10px)}
.up{color:var(--bull)} .dn{color:var(--bear)}
.sb-foot{margin-top:auto;padding:12px 10px;border-top:var(--bdr)}
.aico-sm{width:28px;height:28px;border-radius:3px;background:var(--bg4);border:var(--bdr);display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;color:var(--gold);flex-shrink:0}

.dcontent{
  overflow-y:auto;padding:clamp(10px,1.2vw,20px);
  display:flex;flex-direction:column;gap:clamp(10px,1.1vw,18px);
}
.kpi-row{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
.triple{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.scrd{display:flex;flex-direction:column;min-height:300px}
.corr-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:14px}
.corr-item{text-align:center}
.corr-lbl{font-size:clamp(8px,.58vw,9px);color:var(--txtD);text-transform:uppercase;letter-spacing:.06em;margin-bottom:5px}
.corr-val{font-family:var(--fm);font-size:clamp(20px,1.9vw,30px);font-weight:700}

@media(max-width:1080px){
  .dash-layout{grid-template-columns:1fr}
  .sidebar{display:none}
  .triple{grid-template-columns:1fr}
  .kpi-row{grid-template-columns:repeat(3,1fr)}
  .corr-grid{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>
<div class="scanline"></div>
<div id="nav-mount"></div>

<div class="page">
  <div class="dash-layout">

    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sl">Watchlist</div>
      <div id="sb-tickers"></div>
      <div class="sb-foot">
        <div class="ws-pill" style="width:100%;justify-content:center;font-size:clamp(8px,.58vw,9px)">
          <div class="ws-dot"></div>MOCK — Awaiting C++ Engine
        </div>
      </div>
    </aside>

    <!-- Main -->
    <div class="dcontent">

      <!-- Page header -->
      <div class="flex fca fjb" style="flex-wrap:wrap;gap:10px">
        <div>
          <h2 style="font-size:clamp(18px,1.8vw,26px)">Command Cockpit</h2>
          <p class="sec" style="font-size:clamp(9px,.65vw,11px);margin-top:2px">
            Lead-lag analysis · Triple stream sync · Temporal cursor active
          </p>
        </div>
        <div class="flex fca gap8">
          <span class="bdg b-neu">MOCK DATA</span>
          <a class="btn btn-ghost btn-sm" href="market.html">Ticker Lab →</a>
        </div>
      </div>

      <!-- KPI Strip -->
      <div class="kpi-row stagger" id="kpi-row"></div>

      <!-- Triple Stream -->
      <div class="triple">

        <div class="card scrd tc-wrap" id="sp-media">
          <div class="ch"><span class="ct"><span class="a">MEDIA</span> Oracle</span><span class="bdg b-neu">NLP</span></div>
          <div class="slist" id="sl-media" style="flex:1"></div>
          <div style="padding:5px 10px;border-top:var(--bdr);font-size:clamp(8px,.56vw,9px);color:var(--txtD)">
            Hover → temporal cursor syncs all streams
          </div>
        </div>

        <div class="card scrd tc-wrap" id="sp-sent">
          <div class="ch"><span class="ct"><span class="a">SOCIAL</span> Pulse</span><span class="bdg b-neu">X · Reddit</span></div>
          <div style="padding:6px;border-bottom:var(--bdr)">
            <canvas id="c-sent" style="width:100%;height:54px;display:block"></canvas>
          </div>
          <div class="slist" id="sl-sent" style="flex:1"></div>
        </div>

        <div class="card scrd tc-wrap" id="sp-price">
          <div class="ch"><span class="ct"><span class="a">PRICE</span> Feed</span><span class="bdg b-bull">LIVE</span></div>
          <div style="padding:6px;border-bottom:var(--bdr)">
            <canvas id="c-price" style="width:100%;height:54px;display:block"></canvas>
          </div>
          <div class="slist" id="sl-price" style="flex:1"></div>
        </div>

      </div>

      <!-- Correlation Panel -->
      <div class="card">
        <div class="ch">
          <span class="ct">Pearson <span class="a">R</span> Lead-Lag Matrix</span>
          <span class="bdg b-neu">MOCK COMPUTED</span>
        </div>
        <div class="cb">
          <div class="corr-grid">
            <div class="corr-item">
              <div class="corr-lbl">Sentiment → Price</div>
              <div class="corr-val gold" id="cr-sp">0.68</div>
              <div style="font-size:clamp(8px,.56vw,9px);color:var(--txtD)">at +3.2h lag</div>
            </div>
            <div class="corr-item">
              <div class="corr-lbl">Media → Price</div>
              <div class="corr-val gold">0.54</div>
              <div style="font-size:clamp(8px,.56vw,9px);color:var(--txtD)">at +4.8h lag</div>
            </div>
            <div class="corr-item">
              <div class="corr-lbl">Social Vol → Volatility</div>
              <div class="corr-val bull">0.77</div>
              <div style="font-size:clamp(8px,.56vw,9px);color:var(--txtD)">at +1.5h lag</div>
            </div>
            <div class="corr-item">
              <div class="corr-lbl">Alpha Signal</div>
              <div class="corr-val bull" id="cr-sig">BULL</div>
              <div style="font-size:clamp(8px,.56vw,9px);color:var(--txtD)">composite</div>
            </div>
          </div>
          <div style="padding:10px 12px;background:var(--bg3);border:var(--bdr);border-radius:var(--r1);display:flex;align-items:center;gap:12px;flex-wrap:wrap">
            <div class="ws-pill"><div class="ws-dot"></div>C++ Pearson Engine: PENDING</div>
            <span style="font-size:clamp(8px,.58vw,10px);color:var(--txtD)">
              Live Pearson R scores stream via <code style="color:var(--gold)">ws://localhost:9001</code> when backend connects
            </span>
          </div>
        </div>
      </div>

    </div><!-- /dcontent -->
  </div><!-- /dash-layout -->
</div><!-- /page -->

<script src="js/app.js"></script>
<script>
// Build nav
document.getElementById('nav-mount').innerHTML = buildNav('dash');
startClock();

const ticker = getTicker();

// Preload all
ASSETS.forEach(a => getData(a.t));

// Render sidebar
function renderSidebar(){
  const sb = document.getElementById('sb-tickers');
  sb.innerHTML = ASSETS.map(a => {
    const d = getData(a.t).sum;
    return `<a class="stk ${a.t===ticker?'active':''}" href="market.html" onclick="setTicker('${a.t}')">
      <div class="flex fca gap4">
        <div class="aico-sm">${a.i}</div>
        <span class="stk-sym">${a.t}</span>
      </div>
      <div class="stk-p">
        <div class="stk-val">\$${f(d.price)}</div>
        <div class="stk-chg ${d.chgp>=0?'up':'dn'}">${fp(d.chgp)}</div>
      </div>
    </a>`;
  }).join('');
}
renderSidebar();

// Render dashboard
const D = getData(ticker);
const {sum, prices, sentiment, headlines, social} = D;

// KPI
document.getElementById('kpi-row').innerHTML = `
  <div class="kpi"><div class="kpi-lbl">Price</div><div class="kpi-val gold">\$${f(sum.price)}</div><div class="kpi-sub ${sum.chgp>=0?'bull':'bear'}">${fp(sum.chgp)}</div></div>
  <div class="kpi"><div class="kpi-lbl">Sentiment</div><div class="kpi-val ${sc(sum.sc)==='bull'?'bull':sc(sum.sc)==='bear'?'bear':'sec'}">${sl(sum.sc)}</div><div class="kpi-sub">Score: ${sum.sc}</div></div>
  <div class="kpi"><div class="kpi-lbl">Pearson R</div><div class="kpi-val gold">${sum.pearson}</div><div class="kpi-sub">Sent→Price</div></div>
  <div class="kpi"><div class="kpi-lbl">Signal Lag</div><div class="kpi-val gold">${sum.lag}h</div><div class="kpi-sub">Lead time</div></div>
  <div class="kpi"><div class="kpi-lbl">Volume</div><div class="kpi-val sec">${fv(sum.v)}</div><div class="kpi-sub">H:\$${f(sum.h24)} L:\$${f(sum.l24)}</div></div>
`;

// Set ts range on stream panels
const now = Date.now(), tsStart = now - 8*3600000;
['sp-media','sp-sent','sp-price'].forEach(id=>{
  const el = document.getElementById(id);
  if(el){ el.dataset.ts0 = tsStart; el.dataset.ts1 = now; }
});

// Media stream
document.getElementById('sl-media').innerHTML = headlines.slice(0,9).map(h=>`
  <div class="sitem" data-ts="${h.ts}">
    <div class="stime">
      <span style="color:var(--goldD);font-weight:700">${h.source}</span>
      <span>${ft(h.ts)}</span>
      <span class="bdg b-${sc(h.sentiment)}" style="margin-left:auto">+${h.lag}h</span>
    </div>
    <div class="stxt">${h.headline}</div>
  </div>`).join('');

// Sentiment stream
document.getElementById('sl-sent').innerHTML = social.slice(0,8).map(p=>`
  <div class="sitem" data-ts="${p.ts}">
    <div class="stime">
      <span class="bdg b-${sc(p.s)}">${sl(p.s)}</span>
      <span>${ft(p.ts)}</span>
    </div>
    <div class="stxt">${p.txt.slice(0,88)}…</div>
  </div>`).join('');

// Price stream
document.getElementById('sl-price').innerHTML = prices.slice(-10).reverse().map(p=>{
  const d=p.c-p.o;
  return `<div class="sitem" data-ts="${p.ts}">
    <div class="stime">${ft(p.ts)}</div>
    <div class="stxt flex fca fjb">
      <span>\$${f(p.c)}</span>
      <span class="${d>=0?'bull':'bear'}">${d>=0?'▲':'▼'} ${fp(d/p.o*100)}</span>
    </div>
  </div>`;}).join('');

// Draw charts after layout
requestAnimationFrame(()=>{
  spark(document.getElementById('c-sent'), sentiment.slice(-48).map(s=>s.score), {color:sum.sc>0?'#3ddc84':'#ff4d6d',grid:true});
  spark(document.getElementById('c-price'), prices.slice(-48).map(p=>p.c), {color:'#c5a059',grid:true,lw:1.8});
});

// Temporal cursor
['sp-media','sp-sent','sp-price'].forEach(id => TC.reg(document.getElementById(id)));

// Signal
const sig = document.getElementById('cr-sig');
if(sig){ sig.textContent = sum.sig; sig.className = `corr-val ${sc(sum.sc)==='bull'?'bull':sc(sum.sc)==='bear'?'bear':'sec'}`; }
document.getElementById('cr-sp').textContent = sum.pearson;

// Live tick
startTick((t, s) => {
  if(t !== ticker) return;
  document.querySelectorAll('.kpi-val.gold').forEach((el,i)=>{
    if(i===0) el.textContent=`\$${f(s.price)}`;
  });
});
</script>
</body>
</html>
